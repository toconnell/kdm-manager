<!-- top nav - DEPRECATED -->
<div
    id="topNavBar"
    class="survivor_sheet_gradient"
    style='{{settlement.survivor_color_schemes[survivor.sheet.color_scheme].style_string}}'
>
</div>

<script
	src="/js/survivorSheet.js?v=$application_version"
    ng-init="
        initializeSettlement('survivorSheet', '$api_url','$settlement_id');
        initializeSurvivor('$survivor_id');
	"
>
</script>


<div
    id="survivorSheetApp"
    ng-controller="survivorSheetController"
	ng-if="survivor !== undefined"
	ng-init="
		initializeUser('$user_id');
		initializeScope();
	"
>

    <!-- tabs -->
    <div
        id="viewTabContainer"
        ng-if="survivor.sheet !== undefined"
    >

        <div
            ng-repeat="tab in survivorViewTabsObject.tabs"
            id="{{'survivorViewTabButton-' + tab.id}}"
            class="view_tab_button"
            ng-class="{
                'active': survivorViewTabsObject.activeTab === tab.id,
            }"
            ng-click="
                survivorViewTabsObject.activeTab = tab.id;
            "
        >
            {{tab.name}}
        </div>

    </div>

    <!-- 'Sheet' tab starts here -->

    <div
        id="survivorViewSheetTab"
        class="view_tab"
        ng-show="
            survivorViewTabsObject.activeTab === 0 &&
            survivor.sheet !== undefined
        "
    >

        <div
	    	id="survivorSheetLeftPane"
    	>

            <div
                id="survivorName"
                contentEditable="true"
                class="survivor_sheet_survivor_name"
                ng-click="ngRolledUp['nameControl'] === false || rollUp('nameControl')"
                placeholder="Name"
            >
                {{survivor.sheet.name}}
            </div>


        <div
            id="nameControl"
            class="kd_sheet_ui_roll_down rolled_up"
            ng-controller="survivorNameController"
        >
            <div class="kd_sheet_ui_roll_down_controls">
                <div class="kd_sheet_ui_number_tumbler">
                    <button
                        class="kd_kickstarter_button kd_pink"
                        ng-if="user.user.subscriber.level > 1"
                        ng-click="randomName()"
                    >
                        Random Name
                    </button>
                    <button
                        class="kd_kickstarter_button kd_pink"
                        ng-if="
                            user.user.subscriber.level > 1 &&
                            survivor.sheet.name
                        "
                        ng-click="randomSurname()"
                    >
                        Random Surname
                    </button>
                    <button
                        class="kd_kickstarter_button kd_blue"
                        ng-click="setSurvivorName();"
                    >
                        Save Changes
                    </button>
					<button
						class="kd_kickstarter_button"
						ng-click="
							rollUp('nameControl');
							survivor.sheet.name = scratch.originalName;
						"
					>
						<span ng-if="survivor.sheet.name === scratch.originalName">
							Close
						</span>
						<span ng-if="survivor.sheet.name !== scratch.originalName">
							Undo
						</span>
					</button>
					
                </div> <!-- number tumbler -->
            </div>
        </div> <!-- nameControl -->
        <!-- survivor name controls end here -->


        <!--

            controls for sex, avatar 

        -->

        <div
            ng-if="survivor.sheet != undefined"
            class="survivor_sheet_kd_sheet_ui_box survivor_sex_box"
        >
            <div class="survivor_sheet_avatar_container">
                <label
                    for="avatar_file_input"
                    ng-if="survivor.sheet.avatar != undefined"
                >
                    <img
                        class="survivor_avatar_image"
                        ng-src="{{api_url}}avatar/get/{{survivor.sheet.avatar.$oid}}"
                        alt="Click to change the avatar image for {{survivor.sheet.name}}"
                    />
                </label>
                <label
                    for="avatar_file_input"
                    ng-if="survivor.sheet.avatar == undefined"
                >
                    <img
                        class="survivor_avatar_image"
                        ng-src="/media/default_avatar_{{survivor.sheet.effective_sex}}.png"
                        alt="Click to change the avatar image for {{survivor.sheet.name}}"
                    />
                </label>
                <input
                    id="avatar_file_input"
                    ng-controller='avatarController'
                    ng-model="scratch.newAvatar"
                    ng-blur="setAvatar()"
                    class="hidden"
                    type="file"
                    name="survivor_avatar"
                    accept="image/*"
                    custom-on-change="setAvatar"
                />

            </div> <!-- survivor_sheet_avatar_container -->

            <div
                class="survivor_sex_toggle clickable"
                ng-click="toggleSurvivorSex()"
                ng-if="survivor.sheet.sex == survivor.sheet.effective_sex"
            >
                M <div class="kd_sheet_ui_box" ng-class="{checked: survivor.sheet.sex == 'M'}"></div>
                F <div class="kd_sheet_ui_box" ng-class="{checked: survivor.sheet.sex == 'F'}"></div>
            </div>
            <div
                class="survivor_sex_toggle clickable"
                ng-if="survivor.sheet.sex != survivor.sheet.effective_sex"
                onClick="rollUp('effectiveSexWarning')"
            >
                M <div class="kd_sheet_ui_box" ng-class="{maroon_box: survivor.sheet.effective_sex == 'M'}"></div>
                F <div class="kd_sheet_ui_box" ng-class="{maroon_box: survivor.sheet.effective_sex == 'F'}"></div>
            </div>
        </div> <!-- survivor_sex_box -->

        <div
            id="effectiveSexWarning"
            class="kd_sheet_ui_roll_down rolled_up clickable"
            ng-click="rollUp('effectiveSexWarning')"
        >
            <div class="kd_sheet_ui_roll_down_controls">
                <div class="kd_sheet_ui_row_tip">
                    {{survivor.sheet.name}}'s base sex attribute is <b>{{survivor.sheet.sex}}</b>, but their sex haschanged to <b>{{survivor.sheet.effective_sex}}</b> due the effects of a cursed item!</br>
                    In order to edit this survivor's sex, you must first remove the cursed item that changed their sex to <b>{{survivor.sheet.effective_sex}}</b>.<br/>
                    <i>Click or tap here to hide this notification.</i>
                </div>
            </div>
        </div>

        <!-- end of sex, avatar controls -->


        <!-- affinities opener -->
        <div
            ng-if="survivor.sheet != undefined"
            class="survivor_sheet_kd_sheet_ui_box affinities_opener clickable"
            ng-click="showHide('modalAffinity')"
            title="Permanent affinity bonuses for {{survivor.sheet.name}}. Click or tap to edit!"
        >
            <div
                class="affinity_{{a}} affinity_span"
                ng-repeat="a in ['red','green','blue']"
            >
                {{survivor.sheet.affinities[a]}}
            </div>
        </div> <!-- affinities opener -->


        <div
            id="settlementSheetSurvivalContainer"
            class="survivor_sheet_kd_sheet_ui_box border"
            title="Survival controls and info for {{survivor.sheet.name}}! Click or tap to modify."
            ng-class="{
                'rolled_down': ngRolledUp['survivalControl'] === false,
            }"
        >

            <div
                class="survival_box_number_container clickable"
                ng-click="rollUp('survivalControl')"
            />
                <input
                    class="survivor_sheet survival_box_number"
                    type="number"
                    ng-model="survivor.sheet.survival"
                    min="0"
                />
            </div>

            <div class="survival_box_title_and_lock">
                <div
                    class="survival_box_title clickable"
                    ng-click="rollUp('survivalControl')"
                >
                    Survival
                </div>
                <div
                    class="survival_box_lock clickable"
                    ng-click="toggleStatusFlag('cannot_spend_survival')"
                >
                    <div
                        class="kd_sheet_ui_box"
                        ng-class="{checked: survivor.sheet.cannot_spend_survival == true}"
                    >
                    </div>
                    <div>
                        &#x1f512; Cannot spend survival.
                    </div>
                </div>
            </div>

            <div class="survival_box_survival_actions_container">
                <div
                    class="help-tip survival_box_survival_action_item"
                    ng-repeat="sa in survivor.survival_actions"
                >
                    <div
                        class="kd_sheet_ui_box"
                        ng-class="{checked: sa.available == true}"
                    >
                    </div>
                    <span class="sa_name">{{sa.name}}</span>
                    <p>{{sa.title_tip}}</p>
                </div>
            </div>

        </div> <!-- survival controller ends here for JS! -->

        <!-- SOTF opl -->
        <div
            class="survivor_sheet_kd_sheet_ui_box border clickable"
            ng-if="
                settlement != undefined &&
                settlement.sheet.principles.indexOf('survival_of_the_fittest') != -1
            "
            ng-click="sotfToggle()"
        >
            <div
                class="kd_sheet_ui_box_row sotf_option"
                ng-class="{maroon_text: survivor.sheet.sotf_reroll == true}"
            >
                <div
                    class="kd_sheet_ui_box"
                    ng-class="{maroon_box: survivor.sheet.sotf_reroll == true}"
                >
                </div>
                <div>
                    Once per lifetime reroll
                </div>
            </div>
            <div class="kd_sheet_ui_box_row" ng-if="survivor.sheet.sotf_reroll != true">
                <p class="sotf_reroll_caption">
                    <b>Survival of the fittest:</b> Once per lifetime, a survivor may
                    reroll a single roll result. They must keep this result.</b>
                </p>
            </div>
        </div> <!-- sotf reroll -->

        <div
            id="survivalControl"
            class="kd_sheet_ui_roll_down rolled_up"
        >
            <div class="kd_sheet_ui_roll_down_controls integrated">
                <div
                    class="kd_sheet_ui_row_tip"
                    ng-if="settlement.sheet.enforce_survival_limit == true"
                >
                    {{settlement.sheet.name}} Survival Limit is <b>{{settlement.sheet.survival_limit}}</b>!
                </div>
                <div class="kd_sheet_ui_number_tumbler">
                    <button
                        class="kd_kickstarter_button"
                        ng-disabled="survivor.sheet.can_gain_survival === false"
                        ng-click="
                            survivor.sheet.survival = survivor.sheet.survival + 1
                        "
                    >
                        &#x25B2;
                    </button>
                    <button
                        class="kd_kickstarter_button"
                        ng-disabled="survivor.sheet.survival < 1"
                        ng-click="
                            survivor.sheet.survival = survivor.sheet.survival - 1
                        "
                    >
                        &#x25BC;
                    </button>
                    <button
                        class="kd_kickstarter_button kd_blue"
                        ng-click="
                            updateSurvival();
                            rollUp('survivalControl');
                        "
                    >
                        Save & Close
                    </button>
                </div> <!-- number tumbler -->
            </div>
        </div> <!-- survival controls and rolls -->


        <!-- ATTRIBUTES -->

	    <div
	        class="attributes_container survivor_sheet"
    	>
	        <div
	            ng-repeat="A in ['Movement','Accuracy','Strength','Evasion','Luck','Speed']"
            	ng-class="{last: $last}"
        	    ng-click="rollUp(A + 'AttributeControlBox')"
    	        class="attribute_box clickable {{A}}"
	        >
	            <input
    	            class="attribute_box_number"
        	        type="number"
	                ng-value="
						survivor.sheet[A] +
						survivor.sheet.attribute_detail[A].tokens +
						survivor.sheet.attribute_detail[A].gear
					"
	                ng-class="{
	                    'maroon_text':
							survivor.sheet[A] +
							survivor.sheet.attribute_detail[A].tokens +
							survivor.sheet.attribute_detail[A].gear < survivor.sheet[A]
						,
	                    'green_text':
							survivor.sheet[A] +
							survivor.sheet.attribute_detail[A].tokens +
							survivor.sheet.attribute_detail[A].gear > survivor.sheet[A],
	                };"
	            />
	            {{A}}
	        </div> <!-- attributes repeater -->
	    </div> <!-- attributes container -->

		<!-- controllers repeat here -->

        <div
	        ng-repeat="A in ['Movement','Accuracy','Strength','Evasion','Luck','Speed']"
			id="{{A}}AttributeControlBox"
            class="kd_sheet_ui_roll_down border rolled_up"
        >
            <div
                class="
                    kd_sheet_ui_roll_down_controls
                    quickview_attribute_tumblers_container {{A}}
                "
            >

                <div class="vertical_tumbler_container">
                    Base
                    <button ng-click="survivor.sheet[A] = survivor.sheet[A] + 1">
                        &#x25B2;
                    </button>
					<input type="number" ng-model="survivor.sheet[A]" />
                    <button ng-click="survivor.sheet[A] = survivor.sheet[A] - 1">
                        &#x25BC;
					</button>
                </div>

		        <div class="vertical_tumbler_container">
		            Gear
		            <button
		                ng-click="
		                    survivor.sheet.attribute_detail[A].gear = survivor.sheet.attribute_detail[A].gear + 1
		                "
		            >
	        	        &#x25B2;
    		        </button>
		            <input type="number" ng-model="survivor.sheet.attribute_detail[A].gear" />
		            <button ng-click="survivor.sheet.attribute_detail[A].gear = survivor.sheet.attribute_detail[A].gear - 1">
		                &#x25BC;
		            </button>
		        </div>

		        <div class="vertical_tumbler_container">
		            Tokens
		            <button ng-click="survivor.sheet.attribute_detail[A].tokens = survivor.sheet.attribute_detail[A].tokens + 1">
		                &#x25B2;
		            </button>
		            <input type="number" ng-model="survivor.sheet.attribute_detail[A].tokens" />
		            <button ng-click="survivor.sheet.attribute_detail[A].tokens = survivor.sheet.attribute_detail[A].tokens - 1">
		                &#x25BC;
		            </button>
		        </div>
		    </div>

		    <button
		        class="kd_kickstarter_button kd_blue"
		        ng-click="
		            rollUp(A + 'AttributeControlBox');
		            setSurvivorPrimaryAttributes(survivor, A)
		        "
		    >
		        Save {{A}}
			</button>

		</div> <!-- attrib_list repeater -->

        <!-- attributes end -->







    </div> <!-- asset_management_left_pane -->



    <!-- MIDDLE ASSET MANAGEMENT PANE STARTS HERE -->

    <div id="survivorSheetMiddlePane" ng-if="survivor != undefined">

        <!-- BRAIN -->

        <div
			class="hitbox_container survivor_sheet_brain"
			ng-class="{'insane': survivor.sheet.Insanity >= 3}"
		>

            <div class="hitbox_shield_container brain">

                <input
                    id="insanityBox"
                    type="number"
                    class="survivor_sheet_hitbox hitbox_shield brain"
                    name="Insanity" min="0"
                    ng-model="survivor.sheet.Insanity"
                    ng-click="rollUp('insanityHitBoxControl')"
					ng-class="{'insane': survivor.sheet.Insanity >= 3}"
                />

                Insanity

            </div>

            <div
                class="hitbox_detail brain clickable"
                ng-click="rollUp('insanityHitBoxControl')"
            >
                <div class="title">Brain</div>
                <div
                    class="tip"
					ng-class="{'insane': survivor.sheet.Insanity >= 3}"
                >
                    If your insanity is 3+, you are <b>insane</b>.
                </div>
            </div>

            <div class="hitbox_boxes_container brain">
                <div
                    class="clickable damage_box"
                    ng-class="{
                        'checked': survivor.sheet.brain_damage_light !== undefined,
                    }"
                    ng-click="toggleDamage('brain_damage_light');"
                 /></div>
            </div>

       </div><!-- brain display container -->

       <div
           id="insanityHitBoxControl"
           class="kd_sheet_ui_roll_down rolled_up"
       >
           <div class="kd_sheet_ui_roll_down_controls integrated">
               <div class="kd_sheet_ui_number_tumbler">
                   <button
                       class="kd_kickstarter_button"
                       ng-click="survivor.sheet.Insanity = survivor.sheet.Insanity + 1"
                   >
                       &#x25B2;
                   </button>
                   <button
                       class="kd_kickstarter_button"
                       ng-click="survivor.sheet.Insanity = survivor.sheet.Insanity - 1"
                   >
                       &#x25BC;
                   </button>
                   <button
                       class="kd_kickstarter_button kd_blue"
                       ng-click="updateAttrib('Insanity'); rollUp('insanityHitBoxControl')"
                   >
                       Save & Close
                   </button>
               </div> <!-- number tumbler -->
           </div>
       </div>



        <!-- HIT LOCATIONS -->
        <div
            class="survivor_sheet_hit_location_repeater"
            ng-repeat="location in [
                {name: 'Head', glyph: 'b', dmg: ['heavy']},
                {name: 'Arms', glyph: 'd', dmg: ['light', 'heavy']},
                {name: 'Body', glyph: 'c', dmg: ['light', 'heavy']},
                {name: 'Waist', glyph: 'e', dmg: ['light', 'heavy']},
                {name: 'Legs', glyph: 'f', dmg: ['light', 'heavy']},
            ]"
            ng-init="ctrlBoxID = location.name.toLowerCase() + 'Box' + sheetOID;"
        >
            <div
                class="hitbox_container"
            >
                <div
                    class="hitbox_shield_container clickable"
                    ng-click="rollUp(ctrlBoxID)"
                >
                    <input
                        class="survivor_sheet_hitbox hitbox_shield"
                        type="number"
                        min="0"
                        ng-model="survivor.sheet[location.name]"
                    />
                </div>

                <div
                    class="hitbox_detail"
                    ng-click="rollUp(ctrlBoxID)"
                >
                    <div class="title">
                        <font class="kdm_font_hit_locations">
                            {{location.glyph}}
                        </font>
                        {{location.name}}
                    </div>
                    <div class="tip">
                        Heavy Injury: Knocked Down.
                    </div>
                </div>

                <div class="hitbox_boxes_container">
                    <div
                        ng-repeat="dmgType in location.dmg"
                        ng-init="toggleName = location.name.toLowerCase() + '_damage_' + dmgType"
                        ng-class="
                            {checked: survivor.sheet[toggleName] !== undefined}
                       "
                        ng-click="toggleDamage(toggleName);"
                        class="clickable {{dmgType}} damage_box"
                     />
                     </div>
                </div>

			</div> <!-- hitbox container -->

            <div
                id="{{ctrlBoxID}}"
                class="kd_sheet_ui_roll_down rolled_up"
            >
                <div class="kd_sheet_ui_roll_down_controls">
                    <div class="kd_sheet_ui_number_tumbler">
                        <button
                            class="kd_kickstarter_button"
                            ng-click="survivor.sheet[location.name] = survivor.sheet[location.name] + 1"
                        >
                            &#x25B2;
                        </button>
                        <button
                            class="kd_kickstarter_button"
							ng-disabled="survivor.sheet[location.name] < 1"
                            ng-click="survivor.sheet[location.name] = survivor.sheet[location.name] - 1"
                        >
                            &#x25BC;
                        </button>
                        <button
                            class="kd_kickstarter_button kd_blue"
                            ng-click="
                        		updateAttrib(location.name);
                                rollUp(ctrlBoxID)
                            "
                        >
                            Save & Close
                        </button>
                    </div> <!-- number tumbler -->
                </div><!-- roll_down_controls -->
            </div><!-- roll_down container + loc box ID -->

		</div> <!-- hit location repeater -->

    </div> <!-- HIT BOXES END HERE -->







    <!-- 
    
        SECONDARY ATTRIBS - right column on the stock sheet starts here
    
    -->

    <div class="survivor_sheet_secondary_attribs_container">

        <!-- HUNT XP -->
        <div
            class="survivor_sheet_kd_sheet_ui_box border clickable"
            ng-click="rollUp('huntXPControl')"
            ng-class="{
                'rolled_down': ngRolledUp['huntXPControl'] === false,
            }"
            title="Hunt XP for {{survivor.sheet.name}}. Tap or click to edit!"
        >
            <div class="kd_sheet_ui_box_row hunt_xp">
                <span class="title">Hunt XP</span>
                <div class="hunt_xp_box_container">
                    <span
                        ng-repeat="value in [1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16]"
                        class="kd_sheet_ui_box"
                        ng-class="{
                            'checked': survivor.sheet.hunt_xp >= value,
                            'heavy': [2,6,10,15,16].includes(value),
                            'dotted': value === 16,
                        }"
                    ></span>
                </div>
            </div>
        </div> <!-- HUNT XP -->
        <div
            id="huntXPControl"
            class="kd_sheet_ui_roll_down rolled_up"
        >
            <div
                class="kd_sheet_ui_roll_down_controls integrated"
                ng-if="ngRolledUp['huntXPControl'] === false"
            >

                <div class="kd_sheet_ui_row wrap_tips">
                    <div>
                        <div
                            class="kd_sheet_ui_box heavy"
                            ng-repeat="value in [2]"
                            ng-class="{'checked': survivor.sheet.hunt_xp >= value}"
                        >
                        </div>
                        <font class="kdm_font">g</font> Age
                    </div>
                <div>
                    <div
                        class="kd_sheet_ui_box heavy"
                        ng-repeat="value in [2,6]"
                        ng-class="{'checked': survivor.sheet.hunt_xp >= value}"
                    >
                    </div>
                    <font class="kdm_font">g</font> Age
                </div>
                <div>
                    <div
                        class="kd_sheet_ui_box heavy"
                        ng-repeat="value in [2,6,10]"
                        ng-class="{'checked': survivor.sheet.hunt_xp >= value}"
                    >
                    </div>
                    <font class="kdm_font">g</font> Age
                </div>
                <div>
                    <div
                        class="kd_sheet_ui_box heavy"
                        ng-repeat="value in [2,6,10,15]"
                        ng-class="{'checked': survivor.sheet.hunt_xp >= value}"
                    >
                    </div>
                    <font class="kdm_font">g</font> Age
                </div>
                <div>
                    <div class="kd_sheet_ui_box dotted"></div> Retired
                </div>
            </div><!-- dynamic tip row -->

                <div class="kd_sheet_ui_number_tumbler">
                    <button
                        class="kd_kickstarter_button"
                        ng-click="
                            survivor.sheet.hunt_xp = survivor.sheet.hunt_xp + 1
                        "
                    >
                        &#x25B2;
                    </button>
                    <button
                        class="kd_kickstarter_button"
                        ng-click="
                            survivor.sheet.hunt_xp = survivor.sheet.hunt_xp - 1
                        "
                    >
                        &#x25BC;
                    </button>
                    <button
                        class="kd_kickstarter_button kd_blue"
                        ng-click="
                            updateAttrib('hunt_xp');
                            rollUp('huntXPControl')
                        "
                    >
                        Save & Close
                    </button>
                </div> <!-- number tumbler -->
            </div>
        </div>

        <!-- WEAPON PROFICIENCY -->
        <div
            class="survivor_sheet_kd_sheet_ui_box border clickable"
            ng-click="rollUp('weaponProficiencyControl')"
            ng-class="{
                'rolled_down': ngRolledUp['weaponProficiencyControl'] === false,
            }"
            title="Weapon Proficiency info for {{survivor.sheet.name}}. Tap or click to edit!"
        >
            <div class="kd_sheet_ui_row title_and_value">
                <div class="title">
                Weapon Proficiency
                </div>
                <div class="kd_sheet_ui_box_row long">
                    <span
                        class="kd_sheet_ui_box"
                        ng-repeat="value in [0,1,2,3,4,5,6,7,8]"
                        ng-class="{
                            'checked': survivor.sheet['Weapon Proficiency'] > value,
                            'heavy': [2,8].indexOf(value) !== -1,
                        }"
                    ></span>
                </div>
            </div>
            <div
                class="kd_sheet_ui_row"
                ng-if="survivor.sheet.weapon_proficiency_type !== null"
            >
                <div>
                    <b>Type:</b> {{settlement.game_assets.weapon_proficiency_types[survivor.sheet.weapon_proficiency_type].name}}
                </div>
            </div>
        </div> <!-- survivor_sheet_kd_sheet_ui_box -->
        <div
            id="weaponProficiencyControl"
            class="kd_sheet_ui_roll_down rolled_up"
        >
          <div class="kd_sheet_ui_roll_down_controls integrated">
                <div class="kd_sheet_ui_row dynamic_tip">
                    <div class="dynamic_tip_container">
                        <span
                            class="kd_sheet_ui_box heavy"
                            ng-class="{checked: survivor.sheet['Weapon Proficiency'] > 2}"
                        ></span>
                        <b>Specialist</b>
                    </div>
                    <div class="dynamic_tip_container">
                        <span
                            class="kd_sheet_ui_box heavy"
                            ng-class="{checked: survivor.sheet['Weapon Proficiency'] > 7}"
                        ></span>
                        <span
                            class="kd_sheet_ui_box heavy"
                            ng-class="{checked: survivor.sheet['Weapon Proficiency'] > 7}"
                        ></span>
                        <b>Master</b>
                    </div>
                </div>
                <div class="kd_sheet_ui_number_tumbler">
                    <button
                        class="kd_kickstarter_button"
                        ng-click="
                            survivor.sheet['Weapon Proficiency'] = survivor.sheet['Weapon Proficiency'] + 1
                        "
                    >
                        &#x25B2;
                    </button>
                    <button
                        class="kd_kickstarter_button"
                        ng-click="
                            survivor.sheet['Weapon Proficiency'] = survivor.sheet['Weapon Proficiency'] - 1
                        "
                    >
                        &#x25BC;
                    </button>
                    <select
                        class="kd_kickstarter_select"
                        ng-model="survivor.sheet.weapon_proficiency_type"
                        ng-options="dict.handle as dict.name for dict in settlement.game_assets.weapon_proficiency_types"
                        ng-selected="survivor.sheet.weapon_proficiency_type"
                    >
                        <option disabled value="">Type</option>
                    </select>
                    <button
                        class="kd_kickstarter_button kd_blue"
                        ng-click="
                            setWeaponProficiencyAttribs();
                            rollUp('weaponProficiencyControl')
                        "
                    >
                        Save & Close
                    </button>
                </div><!-- number tumbler-->
            </div>
        </div>

        <!-- COURAGE -->
        <div
            class="survivor_sheet_kd_sheet_ui_box border clickable"
            ng-click="rollUp('courageControl')"
            ng-class="{
                'rolled_down': ngRolledUp['courageControl'] === false,
            }"
            title="Courage controller for {{survivor.sheet.name}}. Tap or click to edit!"
        >
            <div class="kd_sheet_ui_row">
                <div class="title">
                    Courage
                </div>
                <div class="kd_sheet_ui_box_row long">
                    <span
                        class="kd_sheet_ui_box"
                        ng-repeat="value in [0,1,2,3,4,5,6,7,8]"
                        ng-class="{
                            'checked': survivor.sheet.Courage > value,
                            'heavy': [2,8].indexOf(value) !== -1,
                        }"
                    ></span>
                </div>
            </div>
            <div class="kd_sheet_ui_row" ng-if="survivor.sheet.abilities_and_impairments.indexOf('stalwart') != -1">
                <div>
                <b>Stalwart:</b> {{settlement.game_assets.abilities_and_impairments.stalwart.summary}}
                </div>
            </div>
            <div class="kd_sheet_ui_row" ng-if="survivor.sheet.abilities_and_impairments.indexOf('prepared') != -1">
                <div>
                <b>Prepared:</b> {{settlement.game_assets.abilities_and_impairments.prepared.summary}}
                </div>
            </div>
            <div class="kd_sheet_ui_row" ng-if="survivor.sheet.abilities_and_impairments.indexOf('matchmaker') != -1">
                <div>
                <b>Matchmaker:</b> {{settlement.game_assets.abilities_and_impairments.matchmaker.summary}}
                </div>
            </div>
        </div>
        <div
            id="courageControl"
            class="kd_sheet_ui_roll_down rolled_up"
        >
            <div class="kd_sheet_ui_roll_down_controls integrated">
                <div class="ng_fade kd_sheet_ui_ai_toggle_container" ng-if="survivor.sheet.Courage > 2">
                    <div class="kd_sheet_ui_ai_toggle_item">
                        <input
                            type="radio"
                            name="courage_ai"
                            ng-model="scratch.courageAI"
                            id="courageStalwart"
                            value="stalwart"
                        >
                        <label for="courageStalwart">
                            <b>Stalwart:</b> Can't be knocked down by brain trauma or intimidate.
                        </label>
                    </div>
                    <hr/>
                    <div class="kd_sheet_ui_ai_toggle_item">
                        <input
                            type="radio"
                            name="courage_ai"
                            ng-model="scratch.courageAI"
                            id="couragePrepared"
                            value="prepared"
                        >
                        <label for="couragePrepared">
                            <b>Prepared:</b> Add Hunt XP to your roll when determining a straggler.
                        </label>
                    </div>
                    <hr/>
                    <div class="kd_sheet_ui_ai_toggle_item">
                        <input
                            type="radio"
                            name="courage_ai"
                            ng-model="scratch.courageAI"
                            id="courageMatchmaker"
                            value="matchmaker"
                        >
                        <label for="courageMatchmaker">
                            <b>Matchmaker:</b> Spend 1 endeavor to trigger Intimacy story event.
                        </label>
                    </div>
                </div>

                <div class="kd_sheet_ui_row wrap_tips">
                    <div
                        class="dynamic_tip_container"
                        ng-repeat="
                            m in settlement.survivor_attribute_milestones.Courage
                        "
                        ng-if="m.event == 'story_events'"
                    >
                        <span
                            class="kd_sheet_ui_box heavy"
                            ng-class="{checked: survivor.sheet.Courage >= m.values[0]}"
                            ng-repeat="i in numberToRange(m.boxes) track by $index"
                        ></span>
                        <font class="kdm_font">g</font>
                        <b>{{settlement.game_assets.events[m.handle].name}}</b>
                        (p.{{settlement.game_assets.events[m.handle].page}})
                    </div>
                </div>

                <div class="kd_sheet_ui_number_tumbler">
                    <button
                        class="kd_kickstarter_button"
                        ng-click="
                            survivor.sheet.Courage = survivor.sheet.Courage + 1
                        "
                    >
                        &#x25B2;
                    </button>
                    <button
                        class="kd_kickstarter_button"
                        ng-click="
                            survivor.sheet.Courage = survivor.sheet.Courage - 1
                        "
                    >
                        &#x25BC;
                    </button>
                    <button
                        class="kd_kickstarter_button kd_blue"
                        ng-click="
                            updateCourage();
                            rollUp('courageControl')
                        "
                    >
                        Save Changes
                    </button>
                </div> <!-- number tumbler -->
            </div>
        </div>

        <!-- UNDERSTANDING -->
        <div
            class="survivor_sheet_kd_sheet_ui_box border clickable"
            ng-class="{
                'rolled_down': ngRolledUp['understandingControl'] === false,
            }"
            ng-click="rollUp('understandingControl')"
            title="Understanding controller for {{survivor.sheet.name}}. Tap or click to edit!"
        >
            <div class="kd_sheet_ui_row">
                <div class="title">
                    Understanding
                </div>
                <div class="kd_sheet_ui_box_row long">
                    <span
                        class="kd_sheet_ui_box"
                        ng-repeat="value in [0,1,2,3,4,5,6,7,8]"
                        ng-class="{
                            'checked': survivor.sheet.Understanding > value,
                            'heavy': [2,8].indexOf(value) !== -1,
                        }"
                    ></span>
                </div>
            </div>
            <div class="kd_sheet_ui_row" ng-if="survivor.sheet.abilities_and_impairments.indexOf('analyze') != -1">
                <div>
                <b>Analyze:</b> {{settlement.game_assets.abilities_and_impairments.analyze.summary}}
                </div>
            </div>
            <div class="kd_sheet_ui_row" ng-if="survivor.sheet.abilities_and_impairments.indexOf('explore') != -1">
                <div>
                <b>Explore:</b> {{settlement.game_assets.abilities_and_impairments.explore.summary}}
                </div>
            </div>
            <div class="kd_sheet_ui_row" ng-if="survivor.sheet.abilities_and_impairments.indexOf('tinker') != -1">
                <div>
                <b>Tinker:</b> {{settlement.game_assets.abilities_and_impairments.tinker.summary}}
                </div>
            </div>
        </div>
        <div
            id="understandingControl"
            class="kd_sheet_ui_roll_down rolled_up"
        >
            <div class="kd_sheet_ui_roll_down_controls integrated">
                <div class="ng_fade kd_sheet_ui_ai_toggle_container" ng-if="survivor.sheet.Understanding > 2">
                    <div class="kd_sheet_ui_ai_toggle_item">
                        <input
                            type="radio"
                            name="understanding_ai"
                            ng-model="scratch.understandingAI"
                            id="understandingAnalyze"
                            value="analyze"
                        >
                        <label for="understandingAnalyze">
                            <b>Analyze:</b> Look at the top AI card and return it to the top of the deck.
                        </label>
                    </div>
                    <hr/>
                    <div class="kd_sheet_ui_ai_toggle_item">
                        <input
                            type="radio"
                            name="understanding_ai"
                            ng-model="scratch.understandingAI"
                            id="understandingExplore"
                            value="explore"
                        >
                        <label for="understandingExplore">
                            <b>Explore:</b> Add +2 to your <b>investigate</b> roll results.
                        </label>
                    </div>
                    <hr/>
                    <div class="kd_sheet_ui_ai_toggle_item">
                        <input
                            type="radio"
                            name="understanding_ai"
                            ng-model="scratch.understandingAI"
                            id="understandingTinker"
                            value="tinker"
                        >
                        <label for="understandingTinker">
                            <b>Tinker:</b> +1 endeavor when a returning survivor.
                        </label>
                    </div>
                </div>

                <!-- understanding tips -->
                <div class="kd_sheet_ui_row wrap_tips">
                    <div
                        class="dynamic_tip_container"
                        ng-repeat="m in settlement.survivor_attribute_milestones.Understanding"
                        ng-if="m.event == 'story_events'"
                    >
                        <span
                            class="kd_sheet_ui_box heavy"
                            ng-class="{checked: survivor.sheet.Understanding >= m.values[0]}"
                            ng-repeat="i in numberToRange(m.boxes) track by $index"
                        ></span>
                        <font class="kdm_font">g</font>
                        <b>{{settlement.game_assets.events[m.handle].name}}</b>
                        <font class="metrophobic">
                            (p.{{settlement.game_assets.events[m.handle].page}})
                        </font>
                    </div>
                </div>

                <div class="kd_sheet_ui_number_tumbler">
                    <button
                        class="kd_kickstarter_button"
                        ng-click="
                            survivor.sheet.Understanding = survivor.sheet.Understanding + 1
                        "
                    >
                        &#x25B2;
                    </button>
                    <button
                        class="kd_kickstarter_button"
                        ng-click="
                            survivor.sheet.Understanding = survivor.sheet.Understanding - 1
                        "
                    >
                        &#x25BC;
                    </button>
                    <button
                        class="kd_kickstarter_button kd_blue"
                        ng-click="
                            updateUnderstanding();
                            rollUp('understandingControl')
                        "
                    >
                        Save & Close
                    </button>
                </div> <!-- number tumbler -->
            </div>
        </div>

    </div> <!-- survivor_sheet_secondary_attribs_container -->

    <!-- SURVIVOR SPECIAL ATTRIBUTES -->

    <div
        ng-if="settlement.game_assets.survivor_special_attributes.length >= 1"
        class="survivor_sheet_special_attributes_container"
    >
        <div
            class = "survivor_sheet_special_attribute_container clickable"
            ng-repeat="s in settlement.game_assets.survivor_special_attributes"
            ng-click="toggleSpecialAttrib(s.handle)"
            ng-class="{active: survivor.sheet[s.handle] == true}"
            title = "{{s.title_tip}}"
        >
            <div
                class="special_attribute_checkbox"
                ng-class="{active: survivor.sheet[s.handle] == true}"
            ></div>
            <div
                class="special_attribute_text"
                ng-class="{active: survivor.sheet[s.handle] == true}"
            >
                {{s.name}}
            </div>
        </div>
    </div> <!-- survivorSpecialAttribsController -->



    <div id="survivorSheetRightPane" >

        <!-- FARTING ARTS -->
        <div
            class="survivor_sheet_secondary_attrib_container"
            ng-controller='fightingArtsController'
            ng-init="setFAoptions()"
            ng-if="survivor.sheet.fighting_arts != undefined"
        >
            <div class="secondary_attribute_title_bar">
                <div class="title">Fighting Arts</div>
                <div class="subtitle">Maximum 3.</div>
                <div
                    class="lockbox clickable"
                    ng-click="toggleStatusFlag('cannot_use_fighting_arts')"
                >
                    <div
                        class="kd_sheet_ui_box"
                        ng-class="{checked: survivor.sheet.cannot_use_fighting_arts == true}"
                    >
                    </div>
                    &#x1f512; Cannot use Fighting Arts
                </div>
            </div> <!-- title elements -->


            <div
                title="Click or tap to remove survivor Fighting Arts."
                class="survivor_sheet_card_container"
            >
                <div
                    ng-repeat="fa_handle in survivor.sheet.fighting_arts"
                    class="ng_fade survivor_sheet_card survivor_sheet_gradient clickable"
                    ng-class="{true: 'faded'}[survivor.sheet.cannot_use_fighting_arts]"
                >

                    <div ng-if = "settlement.game_assets.fighting_arts[fa_handle] === undefined">
                        <img src="/media/loading_lantern.gif"><br/>
                        Loading Fighting Art data...
                    </div>

                    <div
                        class="survivor_sheet_card_content"
                        ng-init="
                            FA = settlement.game_assets.fighting_arts[fa_handle];
                            expansion_handle = settlement.game_assets.fighting_arts[fa_handle].expansion;
                            expansion_dict = settlement.game_assets.expansions[expansion_handle];
                        "
                        ng-if="settlement.game_assets.fighting_arts[fa_handle] !== undefined"
                        ng-click="rmFightingArt(fa_handle, $index)"
                        title="Click or tap to remove {{FA.name}} from {{survivor.sheet.name}}"
                    >

                        <div
                            class="settlement_sheet_card_expansion_flair"
                            ng-if="expansion_handle != null"
                            title="{{expansion_dict.name}} expansion Fighting Art"
                            style='
                                color: #{{expansion_dict.flair.color}};
                                background-color: #{{expansion_dict.flair.bgcolor}};
                            '
                            >
                        {{expansion_dict.name}}
                        </div>
                            <!-- regular title -->
                        <b ng-if="FA.constellation == null" class="card_title">
                            {{FA.name}}
                        </b>

                            <!-- dragon trait title -->
                        <b ng-if="FA.constellation != null" class="card_title card_constellation">
                            {{FA.name}}
                        </b>

                            <!-- subhead -->
                        <p class="survivor_sheet_card_subhead" ng-if="FA.sub_type != 'strain'">
                            - {{FA.sub_type_pretty}} -
                        </p>
                        <p class="survivor_sheet_card_subhead" ng-if="FA.sub_type === 'strain'">
                            - fighting art, strain -
                        </p>

                        <p class="survivor_sheet_fighting_art_color_span {{FA.sub_type}}_gradient"> </p>
                        <div
                            class="survivor_sheet_card_text"
                            ng-bind-html="FA.desc|trustedHTML"
                        >
                        </div>
                        <div
                            ng-repeat="(level, desc) in FA.levels track by $index"
                            ng-if="desc != ''"
                            title="Tap or click a {{FA.name}} skill level to toggle it on or off."
                        >
                            <div
                                class="survivor_sheet_card_level_block clickable"
                                ng-click="toggleLevel($event, fa_handle, level)"
                                ng-if="survivor.sheet.fighting_arts_levels[fa_handle].indexOf($index) !== -1"
                            >
                                <span class="survivor_sheet_card_level_number toggled_on">{{level}}</span>
                                <span
                                    class="survivor_sheet_card_level_desc toggled_on"
                                    ng-bind-html="desc|trustedHTML"
                                >
                                </span>
                            </div>
                            <div
                                class="survivor_sheet_card_level_block clickable"
                                ng-click="toggleLevel($event, fa_handle, level)"
                                ng-if="survivor.sheet.fighting_arts_levels[fa_handle].indexOf($index) === -1"
                            >
                                <span class="survivor_sheet_card_level_number">{{level}}</span>
                                <span class="survivor_sheet_card_level_desc" ng-bind-html="desc|trustedHTML"></span>
                            </div>
                        </div> <!-- levels -->

                        <!-- Strain Treshold - 10th Anniversary White Speaker, etc. -->

                        <div
                            ng-if="FA.strain_threshold !== undefined"
                            class="fighting_art_card_strain_threshold_container"
                            ng-class="{
                                'kd_promo': FA.strain_threshold.final === undefined,
                                'kd_pink': FA.strain_threshold.final,
                            }"
                        >
                            <div
                                class="fighting_art_card_strain_threshold_blocks_container"
                            >
                                <span
                                    ng-repeat="block in range(FA.strain_threshold.blocks)"
                                    class="strain_block"
                                >
                                </span>
                            </div>
                            <div
                                class="fighting_art_card_strain_threshold_desc"
                                ng-bind-html="FA.strain_threshold.desc|trustedHTML"
                            >
                            </div>
                        </div>

                        <div class="survivor_sheet_card_click_to_remove">Tap or click to <b>remove</b>.</div>
                    </div>

                </div><!-- card content -->

            </div> <!-- survivor_sheet_card_container -->
            <div class="ng_fade survivor_sheet_card_asset_list_container" ng-if="survivor.sheet.fighting_arts.length <= 2">
                <select
                    name="add_fighting_arts"
                    class="kd_kickstarter_select"
                    ng-if="FAoptions != undefined"
                    ng-model="userFA.newFA"
                    ng-change="addFightingArt(); userFA.newFA = FAoptions[0]"
                    ng-blur="userFA.newFA = FAoptions[0]"
                    ng-options="fa.handle as fa.selector_text for fa in FAoptions | orderObjectBy:'handle':false"
                >
                    <option value="" disabled selected>Add Fighting Art</option>
                </select>
                <span ng-if="FAoptions == undefined">Refreshing options...</span>
            </div>


        </div> <!-- fartingArtsController -->

        <!-- DISORDERS -->
        <div
            class="survivor_sheet_secondary_attrib_container"
            ng-controller="disordersController"
            ng-if="survivor.sheet != undefined"
        >
            <div class="secondary_attribute_title_bar">
                <div class="title">Disorders</div>
                <div class="subtitle">Maximum 3.</div>
                <div class="lockbox"><!-- empty --></div>
            </div> <!-- title elements -->


            <div
                title="Click or tap to remove survivor Disorders."
                class="survivor_sheet_card_container disorders_container"
            >
                <div
                    ng-repeat="d_handle in survivor.sheet.disorders"
                    class="ng_fade survivor_sheet_card disorder_card_gradient clickable"
                >
                    <div ng-if = "settlement.game_assets.disorders[d_handle] == undefined">
                        <img src="/media/loading_lantern.gif"><br/>
                        Loading Disorder data...
                    </div>

                    <div
                        class="survivor_sheet_card_content"
                        ng-init="
                            D = settlement.game_assets.disorders[d_handle];
                            expansion_handle = settlement.game_assets.disorders[d_handle].expansion;
                            expansion_dict = settlement.game_assets.expansions[expansion_handle];
                        "
                        ng-if = "settlement.game_assets.disorders[d_handle] != undefined"
                        ng-click="rmDisorder(d_handle, $index)"
                        title="Click or tap to remove {{D.name}} from {{survivor.sheet.name}}"
                    >
                        <!-- EXPANSION FLAIR -->

                        <div
                            class="settlement_sheet_card_expansion_flair"
                            ng-if="expansion_handle != null"
                            title="{{expansion_dict.name}} expansion Disorder"
                            style='
                                color: #{{expansion_dict.flair.color}};
                                background-color: #{{expansion_dict.flair.bgcolor}};
                            '
                        >
                            {{expansion_dict.name}}
                        </div>

                        <!-- regular title -->
                        <b ng-if="D.constellation == null" class="card_title">
                            {{D.name}}
                        </b>

                        <!-- dragon trait title -->
                        <b ng-if="D.constellation != null" class="card_title card_constellation">
                            {{D.name}}
                        </b>
                        <div
                            class="survivor_sheet_card_text disorder_flavor_text"
                            ng-bind-html="D.flavor_text|trustedHTML"
                        >
                        </div>
                        <div
                            class="survivor_sheet_card_text"
                            ng-bind-html="D.survivor_effect|trustedHTML"
                        >
                        </div>

                        <div class="survivor_sheet_card_click_to_remove remove_disorder">
                            Tap or click to <b>remove</b>.
                        </div>

                    </div> <!-- card_content -->
                </div> <!-- disorder ng-repeat -->
            </div> <!-- disorders survivor_sheet_card_container -->

            <div class="ng_fade survivor_sheet_card_asset_list_container" ng-if="survivor.sheet.disorders.length <= 2">
                <select
                    name="add_disorders"
                    class="kd_kickstarter_select"
                    ng-if="dOptions != undefined"
                    ng-model="userD.newD"
                    ng-change="addDisorder(); userD.newD = dOptions[0]"
                    ng-blur="userD.newD = dOptions[0]"
                    ng-options="d.handle as d.selector_text for d in dOptions | orderObjectBy:'handle':false"
                >
                    <option value="" disabled selected>Add Disorder</option>
                </select>
            </div>
        </div> <!-- disordersController -->

        <!-- ABILITIES AND IMPAIRMENTS -->
        <div class="survivor_sheet_secondary_attrib_container">

            <div>
                <div class="secondary_attribute_title_bar">
                    <div class="title">Abilities & Impairments</div>
                    <div
                        class="lockbox"
                        ng-click="toggleStatusFlag('skip_next_hunt')"
                    >
                        <div
                            class="kd_sheet_ui_box"
                            ng-class="{checked: survivor.sheet.skip_next_hunt == true}"
                        >
                        </div>
                        &#x1f512; skip next hunt
                    </div>
                </div>
            </div> <!-- title elements -->

            <div
                class="outer_ai_container"
                title="Click or tap to remove survivor Abilities & Impairments."
            >

                <div
                    class="ng_fade ai_repeater clickable"
                    ng-repeat="ai_handle in survivor.sheet.abilities_and_impairments track by $index"
                    title="Click or tap to remove '{{settlement.game_assets.abilities_and_impairments[ai_handle].name}}'"
                >

                    <div
                        ng-if="ai_handle !== 'partner'"
                        ng-click="rmAI(ai_handle, $index)"
                    >
                        <b
                            ng-if="settlement.game_assets.abilities_and_impairments[ai_handle].constellation == undefined"
                        >
                            {{settlement.game_assets.abilities_and_impairments[ai_handle].name}}:
                        </b>
                        <b
                            ng-if="settlement.game_assets.abilities_and_impairments[ai_handle].constellation != undefined"
                            class="card_constellation"
                        >
                            {{settlement.game_assets.abilities_and_impairments[ai_handle].name}}:
                        </b>

                        <span
                            class="survivor_sheet_ai_desc"
                            ng-bind-html="settlement.game_assets.abilities_and_impairments[ai_handle].desc|trustedHTML"
                        >
                        </span>
                    </div>


                    <!-- PARTNER CONTROLS -->
                    <div
                        class="survivor_sheet_partner_controls"
                        ng-if="ai_handle === 'partner'"
                    >

                        <div
                            class="
                                survivor_sheet_kd_sheet_ui_box
                                survivor_sheet_partner_opener
                                clickable
                                settlement_sheet_gradient
                            "
                            ng-if="survivor.sheet.partner_id == undefined"
                            ng-click="showHide('partnerSelect')"
                        >
                            Select a Partner
                        </div>

                        <div
                            class="
                                survivor_sheet_kd_sheet_ui_box
                                settlement_sheet_gradient
                                survivor_sheet_partner
                                clickable
                            "
                            ng-if="survivor.sheet.partner_id != undefined"
                            ng-click="showHide('partnerSelect')"
                            title="{{survivor.sheet.name}}'s partner is {{partner.sheet.name}}. Click or tap to modify!"
                        >
                            <img
                                ng-if="partner.sheet.avatar != undefined"
                                class="survivor_sheet_partner_avatar"
                                ng-src="{{api_url}}avatar/get/{{partner.sheet.avatar.$oid}}"
                            />
                            <img
                                ng-if="partner.sheet.avatar == undefined"
                                class="survivor_sheet_partner_avatar"
                                ng-src="/media/default_avatar_{{partner.sheet.effective_sex}}.png"
                            />
                            <p>
                                <b>Partner - {{partner.sheet.name}}:</b>
                                <span ng-bind-html="settlement.game_assets.innovations.partnership.desc|trustedHTML"></span>
                            </p>
                        </div>


                    </div> <!-- ng-if="ai_handle === 'partner'" -->

                </div> <!-- ai_repeater. Yes, it ends all the way down here. -->

            </div> <!-- ai 'card' outer container -->

            <select
                id="survivorSheetAISelector"
                name="add_abilities_and_impairments"
                class="kd_kickstarter_select"
                ng-if="AIoptions != undefined"
                ng_model="scratch.newAI"
                ng_change="addAI()"
                ng-options="ai.handle as (ai.name + ' (' + ai.sub_type_pretty + ')'  ) for ai in AIoptions"
            >
                <option value="" disabled selected>Add Abilities & Impairments</option>
            </select>

        </div> <!-- ai -->

    </div> <!-- right panel -->


    <!-- lineage block starts here -->


	<!-- loading -->
    <center
		class="ng_fade"
		ng-if="
			settlement === undefined ||
			survivor === undefined
		"
	>
		<div ng-if="settlement === undefined">
			Waiting for settlement data...
		</div>
		<div ng-if="survivor === undefined">
			Waiting for survivor data...
		</div>
	</center>



</div> <!-- end of the survivor sheet! -->


    <!-- 

        'Notes' tab starts here 

    -->

    <div
        id="survivorViewNotesTab"
        class="view_tab"
        ng-show='survivorViewTabsObject.activeTab === 1'
    >

        <!-- favorite / retired / dead -->
        <div
            ng-if="survivor.sheet != undefined"
            class="survivor_sheet_kd_sheet_ui_box border top_most favorite_retired_dead"
        >
            <div
                class="frd_toggle clickable"
                ng-click="toggleFavorite()"
            >
                <div
                    class="kd_sheet_ui_box"
                    ng-class="{checked: scratch.favoriteBox == true}"
                >
                </div>
                Favorite
            </div>

            <div
                class="frd_toggle clickable"
                ng-click="setRetired()"
            >
                <div
                    class="kd_sheet_ui_box"
                    ng-class="{checked: survivor.sheet.retired == true}"
                >
                </div>
                Retired
            </div>

            <div
                class="frd_toggle clickable"
                ng-click="showHide('modalDeath')"
                ng-class="{maroon_text: survivor.sheet.dead != undefined}"
            >
                <div
                    class="kd_sheet_ui_box"
                    ng-class="{maroon_box: survivor.sheet.dead != undefined}"
                >
                </div>
                Dead
            </div>
        </div> <!-- survivor_dead_retired_container -->

        <!-- dynamic modal launchers -->
        <div
            class="survivor_sheet_kd_sheet_ui_box border dynamic_modal_launchers"
        >
            <button
                id="cursedItemsOpener"
                class="hidden survivor_curse"
                ng-click="showHide('cursedItems')"
            >
                Cursed Items ({{survivor.sheet.cursed_items.length}})
            </button>
            <button
                id="saviorControlsModal"
                class="survivor_sheet_gradient affinity_{{survivor.sheet.savior}}"
                ng-if="settlement.game_assets.campaign.saviors == true"
                ng-click="showHide('modalSavior')"
            >
                Savior
            </button>
            <button
                id="dragonControlsModal"
                class="dragon_king"
                ng-if="settlement.game_assets.campaign.dragon_traits != undefined"
                ng-click="showHide('theConstellations'); reinitialize()"
            >
                Dragon Traits ({{survivor.dragon_traits.trait_list.length}})
            </button>

        </div> <!-- dynamic buttons -->


        <!-- tags! -->
        <div class="survivor_sheet_kd_sheet_ui_box border tags_container">

            <div
                class="ng_fade survivor_sheet_tag collection_gradient"
                ng-repeat="e in survivor.sheet.epithets"
                ng-click="rmEpithet($index)"
                style="
                    background: #{{settlement.game_assets.epithets[e].bgcolor}};
                    background-color: #{{settlement.game_assets.epithets[e].bgcolor}};
                    color: #{{settlement.game_assets.epithets[e].color}};
                    border-color: #{{settlement.game_assets.epithets[e].bordercolor}};
                "
                title="{{settlement.game_assets.epithets[e].name}}. Tap or click to remove!"
            >
                <span>{{settlement.game_assets.epithets[e].name}}</span>
            </div>

            <div
                class="ng_fade survivor_sheet_tag"
                ng-if="survivor.sheet.epithets.length === 0"
            >
                Tap/click to add tags:
            </div>

            <select
                id="epithetSelect"
                name="add_epithets"
                class="survivor_sheet_tag add_tag"
                ng-model="scratch.new_epithet"
                ng-change="addEpithet()"
                ng-options="e.handle as e.name for e in epithetOptions"
            >
                <option value="" disabled selected> + </option>
            </select>

        </div> <!-- tags end here! -->


        <!-- 
            notes 
        -->

        <div
            id="survivorSheetNotesContainer"
            class="survivor_sheet_kd_sheet_ui_box"
        >

            <h3>Notes</h3>

                <div
                class="survivor_sheet_survivor_notes_container"
                title="Survivor notes for {{survivor.sheet.name}}! Click or tap
                to add/remove notes. Notes are included in the Survivor Search
                results."
            >

                <div
                    class="survivor_sheet_survivor_notes_slug_line_container"
                >
                    <div
                        class="survivor_sheet_survivor_notes_slug_line ng_fade"
                        ng-repeat="x in survivor.notes"
                    >
    					<div
	    					class="survivor_sheet_rm_note_clicker kd_pink ng_fade clickable"
                            ng-click="rmNote($index, x._id.$oid)"
                			ng-if="ngVisible['survivorNote' + x._id.$oid]"
				    		id="survivorNote{{ x._id.$oid}}"
    					>
	    					x
		    			</div>

			    		<div
				    		class="survivor_sheet_note_text clickable"
					    	ng-click="ngShowHide('survivorNote' + x._id.$oid)"
						    ng-class="{
    							'active': ngVisible['survivorNote' + x._id.$oid],
	    					}"
		    			>
    	                    {{x.note}}
	    				</div>

                    </div><!-- slug_line -->

                    <div
                        class="survivor_sheet_survivor_notes_slug_line clickable"
                        ng-click="ngShow('settlementSheetNotesEditorModal')"
                    >
	    				<div class="survivor_sheet_note_text">
	                       + Add a note... 
    					</div>
                    </div>

                </div>

            </div> <!-- survivor notes opener -->

            <div
                id="settlementSheetNotesEditorModal"
                ng-if="ngVisible['settlementSheetNotesEditorModal']"
                class="modal-black"
            >
                <div class="kd_sheet_ui_outer_ring_container">

    				<div
	    				class="kd_sheet_ui_inner_ring_container"
		    		>
    					<h3>Add a note!</h3>

    	                <textarea
    	                    id="survivorNoteInput"
        	                class="survivor_sheet_survivor_notes_input"
                	        placeholder="Add notes here! Notes appear in Survivor Search..."
            	            ng-model="scratch.addNote"
    	                >
    					</textarea>

    					<button
	    					class="kd_kickstarter_button kd_blue"
		    				ng-click="
    							addNote();
    							ngHide('settlementSheetNotesEditorModal')
    						"
    					>
    						Save
	    				</button>

    					<button
	    					class="kd_kickstarter_button"
		    				ng-click="ngHide('settlementSheetNotesEditorModal')"
			    		>
    						Close
	    				</button>
		    		</div><!-- notes modal inner -->

    			</div>
    		</div><!-- settlementSheetNotesEditorModal -->

        </div><!-- notes! -->


        <div
            id="survivorSheetBiographyContainer"
            ng-controller="lineageController"
            class="survivor_sheet_kd_sheet_ui_box"
        >

            <h3>Survivor Biography</h3>

            <!-- founder -->
            <p ng-if="survivor.sheet.founder == true">
                <font class="kdm_font_hit_locations">a</font>
                Founding member of {{settlement.sheet.name}}.
            </p>

            <!-- born or joined -->
            <p ng-if="survivor.sheet.father != undefined || survivor.sheet.mother != undefined">
                <font class="kdm_font_hit_locations">a</font>
                Born in LY{{survivor.sheet.born_in_ly}}.
            </p>
            <p ng-if="survivor.sheet.father == undefined && survivor.sheet.mother == undefined && survivor.sheet.founder == false">
                <font class="kdm_font_hit_locations">a</font>
                Joined the settlement in LY{{survivor.sheet.born_in_ly}}.
            </p>

        <!-- inheritance -->
        <div ng-repeat="parent in ['father','mother']">
            <p ng-repeat="ai in survivor.sheet.inherited[parent].abilities_and_impairments">
                <font class="kdm_font_hit_locations">a</font> Inherited <b>{{settlement.game_assets.abilities_and_impairments[ai].name}}</b> from <b>{{survivor.sheet.parents[parent].name}}</b> ({{parent}}).
            </p>
            <p ng-if="survivor.sheet.inherited[parent].weapon_proficiency_type != null" ng-init="wp = survivor.sheet.inherited[parent].weapon_proficiency_type">
                <font class="kdm_font_hit_locations">a</font> Inherited <b>{{settlement.game_assets.weapon_proficiency_types[wp].name}}</b> proficiency from <b>{{survivor.sheet.parents[parent].name}}</b> ({{parent}}).
            </p>
            <p ng-if="survivor.sheet.inherited[parent]['Weapon Proficiency'] > 0">
                <font class="kdm_font_hit_locations">a</font> Inherited {{survivor.sheet['Weapon Proficiency']}} Weapon Proficiency points from <b>{{survivor.sheet.parents[parent].name}}</b> ({{parent}}).
            </p>
        </div>

            <!-- returning survivor -->
            <p ng-if="survivor.sheet.returning_survivor.length >= 1">
                <font class="kdm_font_hit_locations">a</font>
                Returning survivor in the following Lantern Years: {{survivor.sheet.returning_survivor.join(', ')}}.
            </p>

            <!-- retired and dead -->
            <p ng-if="survivor.sheet.retired == true" >
                <font class="kdm_font_hit_locations">a</font>
                Retired in LY{{survivor.sheet.retired_in}}.
            </p>
            <p ng-if="survivor.sheet.dead == true" class="maroon_text">
                <font class="kdm_font_hit_locations">a</font>
                <b>Died in LY{{survivor.sheet.died_in}}.</b>
            </p>

            <div
                ng-if="lineage != undefined"
                class="survivor_sheet_block_group lineage_block"
            >

            <div
                id="survivorParents"
                ng-if="survivor.sheet.founder == false"
            >
                <h4>Parents</h4>

                <select
                    class="kd_kickstarter_select"
                    ng-model="survivor.sheet.father.$oid"
                    ng-selected="survivor.sheet.father"
                    ng-options="s.sheet._id.$oid as s.sheet.name for s in settlement.user_assets.survivors | filter:maleFilter"
                    ng-change="setParent('father',survivor.sheet.father.$oid)"
                >
                    <option disabled value="">Father</option>
                </select>

                <select
                    class="kd_kickstarter_select"
                    ng-model="survivor.sheet.mother.$oid"
                    ng-selected="survivor.sheet.mother"
                    ng-options="s.sheet._id.$oid as s.sheet.name for s in settlement.user_assets.survivors | filter:femaleFilter"
                    ng-change="setParent('mother', survivor.sheet.mother.$oid)"
                >
                    <option disabled value="">Mother</option>
                </select>


            </div>

            <div ng-if="lineage.intimacy_partners >= 1">
                <h4>Intimacy Partners</h4>
                <p>
                    <span ng-repeat="s in lineage.intimacy_partners">{{s.name}}{{$last ? '' : ', '}}</span>
                </p>
            </div>

            <div ng-if="lineage.siblings.full.length >= 1 || lineage.siblings.half.length >= 1">
                <h4>Siblings</h4>
                <p ng-if='lineage.siblings.full.length >= 1'>
                    <i>Full:</i> <span ng-repeat='s in lineage.siblings.full'>
                        {{s.name}}{{$last ? '' : ', '}}
                    </span>
                </p>
                <p ng-if='lineage.siblings.half.length >= 1'>
                    <i>Half</i>: <span ng-repeat='s in lineage.siblings.half'>
                        {{s.name}}{{$last ? '' : ', '}}
                    </span>
                </p>
            </div> <!-- siblings container -->

            <div ng-if="lineage.intimacy_partners.length >= 1">
                <h4>Children</h4>
                <p span ng-repeat="p in lineage.intimacy_partners">
                    <i>with</i> <b>{{p.name}}</b> [{{p.sex}}]</b><i>: </i>
                    <span ng-repeat="s in lineage.children[p._id.$oid]">
                        {{s.name}} (LY{{s.born_in_ly}}){{$last ? '' : ', '}}
                    </span>
                </p>
            </div>
        </div> <!-- survivor_sheet_block_group lineage -->

    </div> <!-- lineage -->


</div>



<!-- 

    'Logs' tab starts here 

-->

<div
    id="survivorViewLogsTab"
    class="view_tab"
    ng-show='survivorViewTabsObject.activeTab === 2'
>

    <div
        class="survivor_sheet_kd_sheet_ui_box top_most"
    >

        <h3>Event Log</h3>

        <div
            class="ng_fade fullTabSpinner"
            ng-if="lineage.events === undefined"
        >
            <img src="/media/loading_io.gif">
            <p>Retrieving Event Log...</p>
        </div>

        <div
            class="survivor_sheet_event_log_container"
            ng-if="lineage.events !== undefined"
        >
            <div
                class="lineage_event_repeater {{event.event_type}}"
                ng-repeat="event in lineage.events"
                ng-class-even="'zebra'"
                title="Date({{event.created_on.$date|date:'yyyy-MM-dd @ h:mma'}});"
            >
                {{event.ly}} - {{event.event}}
            </div><!-- event repeater -->
        </div> <!-- events -->

    </div><!-- container -->

</div> <!-- logs tab ends -->



<!-- 

    'Admin' tab starts here 

-->

<div
    id="survivorViewAdminTab"
    class="view_tab"
    ng-show='survivorViewTabsObject.activeTab === 6'
>

    <div
        class="survivor_sheet_kd_sheet_ui_box border top_most"
    >

        <h3>Multiplayer</h3>

        <div
            class="survivor_sheet_public_toggle clickable"
            ng-click="toggleBoolean('public')"
        >
            <div
                class="kd_sheet_ui_box"
                ng-class="{checked: survivor.sheet.public == true}"
            >
            </div>
            &#x1f512; Any player may manage this survivor
        </div>

        <!-- survivor email -->
        <div
            id="emailTip"
            class="kd_sheet_ui_row_tip"
            ng-if="
                user.user.preferences.show_ui_tips
            "
        >
            Enter another registered user's email address here to make them
            a player in this campaign!
        </div>

        <input
            id="survivorOwnerEmail"
            class="survivor_owner_email"
            onclick="this.select()"
            type="email"
            name="email"
            placeholder="email"
            ng-model="scratch.newSurvivorEmail"
            ng-value="survivor.sheet.email"
            ng-blur="setEmail()"
            ng-click="ngShow('survivorChangeEmailButton')"
        />

        <button
            class="kd_kickstarter_button kd_blue"
            ng-if="ngVisible['survivorChangeEmailButton']"
            ng-click="
                ngHide('survivorChangeEmailButton');
                savedAlert();
            "
        >
            Save
        </button>

        <div
            ng-if="
                user.user.subscriber.level > 1 &&
                user !== undefined &&
                lineage !== undefined
            "
            ng-init="loadUserFriends()"
        >
            <div
                id="emailTip"
                class="kd_sheet_ui_row_tip"
                ng-if="
                    user.user.preferences.show_ui_tips &&
                    user.friends.length > 0
                "
            >
                Tap/click on a friend below to make them the owner of this
                survivor record!
            </div>

            <button
                class="survivor_sheet_friend_repeater clickable kd_kickstarter_button kd_blue"
                ng-repeat="friend in user.friends track by $index"
                ng-click="
                    scratch.newSurvivorEmail = friend.login;
                    setEmail();
                "
            >
                {{ friend.login }}
            </button>

        </div>

    </div>

    <!-- permanent delete; this is going to Settlement SOON -->
    <div
        class="survivor_sheet_kd_sheet_ui_box border"
        ng-if="user.user.preferences.show_remove_button == true"
    >

        <h3>Permanently Delete Survivor</h3>

        <div
            ng-if="user.user.preferences.show_remove_button"
        >
            <p>
                Use the button below to permanently delete <b>{{survivor.sheet.name}}</b>.
            </p>
            <p class="maroon_text">
                <b>This cannot be undone.</b>
            </p>

            <button
                class="kd_kickstarter_button kd_pink red_glow permanently_delete"
                ng-click="showHide('removeSurvivorConfirmation')"
            >
                Delete Survivor
            </button>

        </div>

    </div><!-- survivor permanent removal controls end here -->

</div><!-- ADMIN TAB ENDS. survivorSheetController continues... -->



<!--
    
    THIS IS THE FOLD! Only Modal content below!
    Everything past here needs its own controller, etc.

-->

<div
    id="removeSurvivorConfirmation"
    class="modal-black hidden"
    ng-controller="removeSurvivorController"
>
    <div class="rm_asset_confirm_container kd_red">

        <h3>DELETE SURVIVOR</h3>

        <p>
            This cannot be undone! A deleted survivor can <b>never</b> be recovered.
        </p>
        <p>
            Deleting a survivor is not the same thing as using the controls
            above to mark the survivor as "Dead". Survivors should be deleted
            when they are created in error, etc.
        </p>
        <p>
            If you still want to permanently delete <b>{{survivor.sheet.name}}</b>,
            type "DELETE" (without the quotes) in the box below and then click the
            "DELETE" button that appears to permanently delete this survivor forever.
        </p>
    
        <input
            type="text"
            class="confirm_remove"
            ng-model="scratch.confirmRemove"
            placeholder="DELETE"
        />

        <button
            class="kd_kickstarter_button kd_pink red_glow ng_fade"
            ng-if="scratch.confirmRemove === 'DELETE'"
            onClick="showFullPageLoader()"
            ng-click="
                showHide('removeSurvivorConfirmation');
                removeSurvivor();
                postForm('view_campaign',settlement.sheet._id.$oid);
            "
        >
            Delete Survivor
        </button>

        <button
            class="kd_kickstarter_button ng_fade"
            ng-if="scratch.confirmRemove !== 'DELETE'"
            ng-click="showHide('removeSurvivorConfirmation')"
        >
            Close
        </button>

    </div><!-- rm_asset_confirm_container -->

</div><!-- removeSurvivorConfirmation -->


<div
    id="partnerSelect"
    class="modal-black hidden"
>
    <div
        class="partner_selector clickable survivor_sheet_gradient"
        ng-repeat="s in settlement.user_assets.survivors"
        ng-if="s.sheet.dead != true && s.sheet._id.$oid != survivor_id"
        ng-click="setPartner(s.sheet._id); showHide('partnerSelect')"
    >
        <img
            ng-if="s.sheet.avatar != undefined"
            class="partner_select_avatar"
            ng-src="{{api_url}}avatar/get/{{s.sheet.avatar.$oid}}"
        />
        <img
            ng-if="s.sheet.avatar == undefined"
            class="partner_select_avatar"
            ng-src="/media/default_avatar_{{survivor.sheet.effective_sex}}.png"
        />
        <div>
            <b>{{s.sheet.name}}</b> [{{s.sheet.sex}}]<br/>
            Hunt XP: {{s.sheet.hunt_xp}} | Courage: {{s.sheet.Courage}} | Understanding: {{s.sheet.Understanding}}<br/>
            <span ng-if="s.sheet.email != user_login"> &nbsp; <i>{{s.sheet.email}}</i></span>
        </div>
    </div>

    <button
        class="kd_kickstarter_button kd_pink"
        ng-if="survivor.sheet.partner_id != undefined"
        ng-Click="setPartner('UNSET'); showHide('partnerSelect')"
    >
        Remove partner
    </button>
    <button
        class="kd_kickstarter_button"
        ng-click="showHide('partnerSelect')"
    >
        Cancel
    </button>

</div> <!-- partner modal selection menu / partnerSelect -->

<!-- CURSED ITEMS CONTROLS -->
<div
    id="cursedItems" class="modal hidden"
    ng-controller="cursedItemsController"
    ng-if="settlement != undefined"
    ng-init="showHide('cursedItemsOpener');"
>
    <div class="modal-content survivor_sheet_gradient">
        <span class="closeModal" onclick="showHide('cursedItems')"></span>

        <h3>Cursed Items</h3>
        <p>Use the controls below to add cursed items to a Survivor. Cursed
        gear cannot be removed from the Survivor's gear grid. Archive the gear
        when the survivor dies.</p>

        <div class="cursed_items_flex_container">

            <div class="cursed_item_toggle" ng-repeat="c in settlement.game_assets.cursed_items">
                <input
                    id="{{c.handle}}"
                    class="cursed_item_toggle"
                    type="checkbox"
                    ng-model="cursedItemHandle"
                    ng-change="toggleCursedItem(c.handle)"
                    ng-checked="survivor.sheet.cursed_items.indexOf(c.handle) != -1"
                />
                <label
                    class="cursed_item_toggle"
                    for="{{c.handle}}"
                 >
                    <span class="cursed_item_name">{{c.name}}</span>

                    <div class="cursed_item_ability_block" ng-repeat="a in c.abilities_and_impairments">
                        <span
                            ng-if="settlement.game_assets.abilities_and_impairments[a] != undefined"
                            class="cursed_item_ability"
                        >
                            {{settlement.game_assets.abilities_and_impairments[a].name}} -
                        </span>
                        <span
                            class="cursed_item_ability_desc"
                            ng-if="settlement.game_assets.abilities_and_impairments[a] != undefined"
                            ng-bind-html="settlement.game_assets.abilities_and_impairments[a].desc|trustedHTML"
                        >
                        </span>

                    </div>
                </label>

            </div><!-- cursed_item_toggle -->
        </div> <!-- cursed_items_flex_container-->
    </div> <!-- modal-content -->
</div> <!-- modal -->


    <!-- THE CONSTELLATIONS -->
    <div
        id="theConstellations"
        class="modal hidden"
        ng-controller='theConstellationsController'
    >
        <div class="modal-content survivor_sheet_gradient">

            <span class="closeModal" onclick="showHide('theConstellations')"></span>

            <h3>The Constellations</h3>

            <table id="survivor_constellation_table">
                <tr><th colspan="6">&nbsp;</th></tr>
                <tr>
                    <th>&nbsp;</th>
                    <th>Witch</th>
                    <th>Rust</th>
                    <th>Storm</th>
                    <th>Reaper</th>
                    <th>&nbsp;</th>
                </tr>
                <tr>
                    <th>Gambler</th>
                    <td ng-if="survivor.dragon_traits.active_cells.includes('A1') == false">9 Understanding (max)</td>
                    <td ng-if="survivor.dragon_traits.active_cells.includes('A1') == true" class="active">9 Understanding (max)</td>
                    <td ng-if="survivor.dragon_traits.active_cells.includes('B1') == false">Destined disorder</td>
                    <td ng-if="survivor.dragon_traits.active_cells.includes('B1') == true" class="active">Destined disorder</td>
                    <td ng-if="survivor.dragon_traits.active_cells.includes('C1') == false">Fated Blow fighting art</td>
                    <td ng-if="survivor.dragon_traits.active_cells.includes('C1') == true" class="active">Fated Blow fighting art</td>
                    <td ng-if="survivor.dragon_traits.active_cells.includes('D1') == false">Pristine ability</td>
                    <td ng-if="survivor.dragon_traits.active_cells.includes('D1') == true" class="active">Pristine ability</td>
                </tr>
                <tr>
                    <th>Absolute</th>
                    <td ng-if="survivor.dragon_traits.active_cells.includes('A2') == false">Reincarnated Surname</td>
                    <td ng-if="survivor.dragon_traits.active_cells.includes('A2') == true" class="active">Reincarnated Surname</td>
                    <td ng-if="survivor.dragon_traits.active_cells.includes('B2') == false">Frozen Star secret fighting art</td>
                    <td ng-if="survivor.dragon_traits.active_cells.includes('B2') == true" class="active">Frozen Star secret fighting art</td>
                    <td ng-if="survivor.dragon_traits.active_cells.includes('C2') == false">Iridescent Hide ability</td>
                    <td ng-if="survivor.dragon_traits.active_cells.includes('C2') == true" class="active">Iridescent Hide ability</td>
                    <td ng-if="survivor.dragon_traits.active_cells.includes('D2') == false">Champion's Rite fighting art</td>
                    <td ng-if="survivor.dragon_traits.active_cells.includes('D2') == true" class="active">Champion's Rite fighting art</td>
                </tr>
                <tr>
                    <th>Sculptor</th>
                    <td ng-if="survivor.dragon_traits.active_cells.includes('A3') == false">Scar</td>
                    <td ng-if="survivor.dragon_traits.active_cells.includes('A3') == true" class="active">Scar</td>
                    <td ng-if="survivor.dragon_traits.active_cells.includes('B3') == false">Noble surname</td>
                    <td ng-if="survivor.dragon_traits.active_cells.includes('B3') == true" class="active">Noble surname</td>
                    <td ng-if="survivor.dragon_traits.active_cells.includes('C3') == false">Weapon Mastery</td>
                    <td ng-if="survivor.dragon_traits.active_cells.includes('C3') == true" class="active">Weapon Mastery</td>
                    <td ng-if="survivor.dragon_traits.active_cells.includes('D3') == false">+1 Accuracy attribute</td>
                    <td ng-if="survivor.dragon_traits.active_cells.includes('D3') == true" class="active">+1 Accuracy attribute</td>
                </tr>
                <tr>
                    <th>Goblin</th>
                    <td ng-if="survivor.dragon_traits.active_cells.includes('A4') == false">Oracle's Eye ability</td>
                    <td ng-if="survivor.dragon_traits.active_cells.includes('A4') == true" class="active">Oracle's Eye ability</td>
                    <td ng-if="survivor.dragon_traits.active_cells.includes('B4') == false">Unbreakable fighting art</td>
                    <td ng-if="survivor.dragon_traits.active_cells.includes('B4') == true" class="active">Unbreakable fighting art</td>
                    <td ng-if="survivor.dragon_traits.active_cells.includes('C4') == false">3+ Strength attribute</td>
                    <td ng-if="survivor.dragon_traits.active_cells.includes('C4') == true" class="active">3+ Strength attribute</td>
                    <td ng-if="survivor.dragon_traits.active_cells.includes('D4') == false">9 Courage (max)</td>
                    <td ng-if="survivor.dragon_traits.active_cells.includes('D4') == true" class="active">9 courage (max)</td>
                </tr>
                <tr><th colspan="6">&nbsp;</th></tr>

            </table>
            <br />

            <div id="survivor_constellation_control_container">

                <select
                    class="kd_kickstarter_select"
                    ng-if="survivor.dragon_traits.available_constellations.length >= 1"
                    ng-model="survivor.sheet.constellation"
                    ng-options="c for c in survivor.dragon_traits.available_constellations"
                    ng-change="setConstellation(survivor.sheet.constellation)"
                    ng-selected="survivor.sheet.constellation"
                >
                    <option disabled value="">Choose a Constellation</option>
                </select>

                <button
                    class="kd_kickstarter_button"
                    ng-if="survivor.sheet.constellation != undefined"
                    ng-click="unsetConstellation()"
                >
                    Unset Constellation
                </button>
            </div>

            <br/><br/>

        </div> <!-- modal-content -->

    </div> <!-- dragonTraitsModal ng-controller -->
    <!-- SAVIOR CONTROLS -->


    <div
        ng-controller="saviorController"
        id="modalSavior" class="modal hidden"
    >
        <div class="modal-content survivor_sheet_gradient">
            <span class="closeModal" ng-click="showHide('modalSavior')"></span>

            <h3>Savior</h3>

            <button
                class="kd_kickstarter_button affinity_red"
                ng-click="setSaviorStatus('red')"
            >
                Dream of the Beast
            </button>
            <button
                class="kd_kickstarter_button affinity_green"
                ng-click="setSaviorStatus('green')"
            >
                Dream of the Crown
            </button>
            <button
                class="kd_kickstarter_button affinity_blue"
                ng-click="setSaviorStatus('blue')"
            >
                Dream of the Lantern
            </button>

            <br/>

            <button
                class="kd_kickstarter_button"
                ng-if = "survivor.sheet.savior != false"
                ng-click = "unsetSaviorStatus()"
            >
                Unset Savior Info
            </button>

        </div> <!-- modal-content -->

    </div> <!-- modalSavior -->


<!-- controls of death -->
<div
    id="modalDeath" class="modal hidden"
    ng-if="survivor != undefined"
    ng-controller="controlsOfDeath"
>
    <div class="modal-content survivor_sheet_gradient">
        <span class="closeModal" onclick="showHide('modalDeath')"></span>
        <h3>Controls of Death!</h3>
        <select
            class="kd_kickstarter_select"
            ng-model="survivor.sheet.cause_of_death"
            ng-options="c.name as c.name disable when c.disabled for c in settlement.game_assets.causes_of_death"
            ng-change="processSelectCOD()"
            ng-selected='survivor.sheet.cause_of_death'
        >
            <option disabled value="">Choose Cause of Death</option>
        </select>

        <p id="addCustomCOD" style="display: none">
            <input
                type="text"
                class="custom_cod_text"
                placeholder="Enter custom Cause of Death"
                name="enter_cause_of_death"
                ng-value="survivor.sheet.cause_of_death"
                ng-model="customCOD"
            />
        </p>

        <p
            id="addCustomCOD"
            ng-if="
                survivor.sheet.cause_of_death != undefined &&
                settlement_cod_list.indexOf(survivor.sheet.cause_of_death) == -1
            "
        >
            <input
                type="text"
                class="custom_cod_text"
                placeholder="Enter custom Cause of Death"
                name="enter_cause_of_death"
                ng-value="survivor.sheet.cause_of_death"
                ng-model="customCOD"
            />
        </p>

        <div
            id="CODwarning"
            class="kd_alert control_error"
            style="display: none"
        >
            Please select or enter a Cause of Death!
        </div>

        <button
            class="kd_kickstarter_button kd_pink"
            ng-click="submitCOD(customCOD)"
        >
            Die
        </button>
        <div ng-if="survivor.sheet.dead == true">
            <button
                class="kd_kickstarter_button kd_blue"
                ng-click="resurrect()"
            >
                Resurrect {{survivor.sheet.name}}
            </button>
        </div>

    </div> <!-- modal-content -->
</div> <!-- modalDeath -->



<!-- Modal affinities controller -->
<div
    id="modalAffinity"
    class="modal hidden"
    ng-controller = "affinitiesController"
    ng-if="survivor != undefined"
>
    <div class="modal-content survivor_sheet_gradient survivor_affinities_modal">

        <span
            class="closeModal"
            ng-click="showHide('modalAffinity'); savedAlert()"
        >
            
        </span>

        <h3>Survivor Affinities</h3>

        <p>
            Adjust permanent affinities for <b>{{survivor.sheet.name}}</b>.
            Changes are saved automatically.
        </p>

        <div class="survivor_sheet_affinity_controls_container">

            <div
                ng-repeat="a in ['red','green','blue']"
                class="survivor_sheet_affinity_controls_repeater"
            >
                <div
                    class="vertical_tumbler_container"
                    title="{{a}} affinity controls"
                >
                    <button
                        ng-click="incrementAffinity(a, 1)"
                    >
                        &#x25B2;
                    </button>
                    <input
                        id="{{a}}CountBox"
                        type="number"
                        name="{{a}}_affinities"
                        ng-value="survivor.sheet.affinities[a]"
                        ng-model = 'affValue'
                        ng-change = "updateAffinity(this)"
                    />
                    <button
                        ng-disabled="survivor.sheet.affinities[a] < 1"
                        ng-click="incrementAffinity(a, -1)"
                    >
                        &#x25BC;
                    </button>
                </div>

                <div class="affinity_block affinity_{{a}}">&nbsp;</div>

            </div> <!-- modal_affinity_control_unit REPEATS/ng-repeat-->

        </div> <!-- modal_affinity_controls_container -->
    </div> <!-- modal-content -->
</div> <!-- modalAffinity -->



<!-- this has to close everything, including the fold -->
</div><!-- end of the survivorSheetController scope -->
